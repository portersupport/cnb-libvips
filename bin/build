#!/usr/bin/env bash

# Usage: compile <BUILD_DIR> <CACHE_DIR> <ENV_DIR>

# fail fast and loudly
set -euo pipefail

echo $0 $1 

echo "\$0 contents:"
ls $0

echo "\$1 contents:"
ls $1
echo $CNB_BUILDPACK_DIR

echo "CNB_BUILDPACK_DIR contents:"
ls $CNB_BUILDPACK_DIR

echo $CNB_PLATFORM_DIR

BUILD_DIR="."
CACHE_DIR=$1
ENV_DIR="$CNB_PLATFORM_DIR/env/"
TMP_DIR="$BUILD_DIR/.libvips-tmp"
BP_DIR=$CNB_BUILDPACK_DIR
VENDOR_PATH="$BUILD_DIR/.heroku"
VIPS_PATH="$VENDOR_PATH/vips"

source "$BP_DIR/bin/buildscript.sh"

ensure_dirs
install_libvips
cleanup_build
export_profile
